#!/usr/bin/python
import itertools
import functools
from multiprocessing import Pool
import re
import os
from os.path import isfile, join
import time
import sys
import gc
from collections import OrderedDict
from ASM_Parser_TESTFILE import populateFeatures,path1,generateFeatures,featureDict

def main():
	try:
		returnedList=[]
		#path2='/home/aniket/MicrosoftMalware/Sample/Test2/'
		print("Path1 : "+path1)
		onlyfiles = [ f for f in os.listdir(path1) if ".asm" in f]
		print("_______FEATURE EXTRACTION STARTS FOR PATH1_______")
		#flushAllDictionaries()
		p = Pool(32)
		returnedList=p.map(functools.partial(populateFeatures, filePath=path1), onlyfiles)
		#returnedList=p.map(populateFeatures,onlyfiles)
		p.close()
		p.join()
		print("_____ PROCESSING OUTPUT OF MAP FUNCTION FOR FEATURE_EXTRACTION STARTS______")
	except:
		print("Something went wrong")
	print("returnedList")
	print(returnedList)
	generateFeatures(returnedList)
	gc.collect()	


if __name__ == "__main__": 
	#Rediecting all output to file
	orig_stdout=sys.stdout
	f=file('out.txt','a')
	sys.stdout=f

	#print path
	start = time.asctime(time.localtime(time.time()))
	print("Start Time : "+start)
	print("Second Program Starts")
	main()
	end = time.asctime(time.localtime(time.time()))
	print("End Time : "+end)
	print("Second Program Ends")
	#print(str(time.time() - start)
