#!/usr/bin/python
from collections import OrderedDict
import csv
## Local variable
#trainFile='2gramTrainSAMPLE.features'
#trainFile='features.csv'
#testFile='test.csv'
writeFileName='NEW_TRAIN_AFTER_FEATURESELCTION.csv'

## Big Red II variable
trainFile='/N/dc2/scratch/anikgaik/dm/asm_features/features.csv'
testFile='test.csv'
#writeFileName='NEW_TRAIN.csv'


featureDict=OrderedDict()
headerList=[]
dataCount=0
featureCount=0

def featureSelection():
	global featureDict,headerList,dataCount
	f=open(trainFile,'r')
	#### Initialize the the dictionary ####
	header=f.readline().split(',')
	for key in header:
		key=key.replace('\n','')
		featureDict[key]=0
		headerList.append(key)

	print("HeaderList length : "+str(len(headerList)))	
	for line in f:
		dataCount+=1
		data=line.split(',')
		print("Lenth of data : "+str(len(data)))
		if(len(data)>33710):
			print(data)
			continue
		index=-1
		for entry in data:
			index+=1
			entry=entry.replace('\n','')
			#print("entry : "+entry)
			if(entry=='0'):
				#print(index)
				featureDict[headerList[index]]+=1

	#print("data : "+str(featureDict['.DATA']))
	f.close()
	

def checkDictionary():
	global featureCount
	threshold=int(dataCount*0.99)
	for key in featureDict:
		### if feature is occuring atleast 0.1 times, consider that feature
		if(featureDict[key]>threshold):
			del featureDict[key]
		else:
			#print("Key : "+str(key)+" , "+"Value : "+str(featureDict[key]))
			featureCount+=1
		

def writeNewFeatureFile():
	global featureDict
	f=open(trainFile,'r')
	f_write=open(writeFileName,'w')
	indexList=[]

	print("Writting Header start")
	new_header=""
	header=f.readline().split(',')
	header=[w.replace('\n','') for w in header]
	for key in header:
		#key=key.replace('\n','')
		if(key in featureDict):
			new_header+=str(key)+','
			indexList.append(header.index(key))
	new_header=new_header[:-1]+"\n"
	f_write.write(new_header)
	print("Writting Header end")
	#print("indexList : ")
	#print(indexList)

	print("Data processing and writting to file start")
	entryCount=0
	new_line=""
	for line in f:
		entryCount+=1
		if(entryCount%1000==0):
			print("Number of rows processed are : "+str(entryCount))
		data=line.split(',')
		data=[w.replace('\n','') for w in data]
		for index in indexList:
			new_line+=str(data[index])+','
		new_line=new_line[:-1]+"\n"
	new_line=new_line[:-1]	
	f_write.write(new_line)
	f_write.close()
	print("Data processing and writting to file ends")

def printDictionary():
	for key in featureDict:
		print("Key : "+str(key)+" , "+"Value : "+str(featureDict[key]))	
	print("FeatureCount : "+str(featureCount))

if __name__=="__main__":
	featureSelection()
	print("dataCount : "+str(int(dataCount*0.99)))
	
	print("*** checkDictionary ****")
	checkDictionary()
	#print("*** printDictionary ****")
	#printDictionary()
	print("*** writeNewFeatureFile ****")
	writeNewFeatureFile()
	print("FeatureCount : "+str(featureCount))
