#!/usr/bin/python
from sklearn.decomposition import PCA
import math
import numpy as np
import csv
import sys

#train=[[1,2,2,1],[2,1,1,1],[1,1,1,1],[1,1,2,1],[1,1,1,2]]
#label=[1,1,2,1,2]
#test=[[1,1,2,1],[1,1,1,1]]

train=[]
label=[]
test=[]
actualLabel=[]
predicted={}
#Local machine 
#trainFile='features.csv'
#testFile='test.csv'
#Big red II
trainFile='/N/dc2/scratch/anikgaik/dm/NEW_TRAIN_AFTER_FEATURESELCTION1.csv'
testFile='/N/dc2/scratch/anikgaik/dm/NEW_TEST_AFTER_FEATURESELCTION1.csv'
#trainFile='/N/dc2/scratch/hydargah/dm/featureFiles/2gramTrain.features'
#testFile='/N/dc2/scratch/hydargah/dm/featureFiles/2gramTest.features'
testFileList=[]
l=0
newTrain=[]
newTest=[]
explained_train_var_ratio=[]
explained_test_var_ratio=[]

def CALL_PCA():
	global l,newTrain,newTest,explained_train_var_ratio,explained_test_var_ratio,label,testFileList
	f=open(trainFile)
	f.readline()
	for line in iter(f):
		token=line.split(',')
		l=len(token)
		train.append(token[1:len(token)-1])
		label.append(token[-1].replace('\n',''))
	f.close()

	f=open(testFile)
	f.readline()
	for line in iter(f):
		token=line.split(',')
		testFileList.append(token[0])	
		test.append(token[1:])
		#actualLabel.append(token[-1].replace('\n',''))
	f.close()
	#print("Train : ")
	#print(train)
	#print("Test : ")
	#print(test)
	print("******* PCA o train data ************")
	X=np.array(train)
	pca=PCA(n_components=5)
	newTrain=pca.fit_transform(X)
	print("***** Transormed train data *****")
	
	with open('train_PCA.csv', 'w') as fp:
		a = csv.writer(fp, delimiter=',')
		a.writerows(newTrain)
	
	print(newTrain)
	print("***** Explained Variance by data ******")
	explained_train_var_ratio=pca.explained_variance_ratio_
	print(explained_train_var_ratio)

	print("******* PCA on test data ************")
	X=np.array(test)
	pca=PCA(n_components=5)
	newTest=pca.fit_transform(X)
	print("***** Transormed test data *****")

	with open('test_PCA.csv', 'w') as fp:
		a = csv.writer(fp, delimiter=',')
		a.writerows(newTest)

	print(newTest)
	print("***** Explained Variance by data ******")
	explained_test_var_ratio=pca.explained_variance_ratio_
	print(explained_train_var_ratio)
	
	print("******* Writting Train Labels *********")
	with open('LABELS.csv', 'w') as fp:
		a = csv.writer(fp, delimiter=',')
		a.writerows(label)

	print("****** Writting Test File Names ******")
	print(testFileList)
	fp=open('TESTFILENAMES.csv', 'w')
	for entry in testFileList:
		fp.write(entry+"\n")
	fp.close()
	#with open('TESTFILENAMES.csv', 'w') as fp:
		#a = csv.writer(fp, delimiter='')
		#a.writerows(testFileList)

def main():
	CALL_PCA()	

if __name__=="__main__":
	orig_stdout=sys.stdout
	f=file('LOG_PCA.txt','w')
	sys.stdout=f
	main()

